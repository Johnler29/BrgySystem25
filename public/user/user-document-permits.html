<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Request Documents â€” Barangay Langkaan II</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            'inter': ['Inter', 'system-ui', '-apple-system', 'sans-serif'],
          }
        }
      }
    }
  </script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/base.css">
  <style>
    .bg-primary-btn { background-color: #3498db; }
    .bg-ghost-btn { background-color: #ecf0f1; }
    .text-primary-btn { color: #2c3e50; }
    .border-input { border-color: #dfe6e9; }
  </style>
</head>

<script defer src="/base-header.js"></script>
<script defer src="/base.js"></script>

<body class="font-inter">
<div class="dashboard-container">
  <nav class="sidebar" id="sidebar">
    <div class="sidebar-header">
      <img src="https://scontent.fmnl31-1.fna.fbcdn.net/v/t1.15752-9/566459805_2304695176635817_7965723576219961744_n.png?_nc_cat=100&ccb=1-7&_nc_sid=9f807c&_nc_eui2=AeFvsvFPtYKGEdwHZwyXJu6hLWJQAEjhjVotYlAASOGNWmCLSn6KIuOYN8ElKlNNHQrO159FSCuwFcll7OgdlzCP&_nc_ohc=yiA3bhEGnNAQ7kNvwGUy1mZ&_nc_oc=AdkuAJIw6rTtWuKWDNP7QJAFplSOwMhvUK5rJ7b_uZdCToSR1sT73c7CFJ5zrYhIU-I&_nc_zt=23&_nc_ht=scontent.fmnl31-1.fna&oh=03_Q7cD3gGocOn0qEMEx3iINh9aOx48m0LIlXIab9IT08mckx_JZw&oe=692126F5" alt="Logo">
      <h3 class="sidebar-title">Barangay Langkaan II<br><small style="font-size:0.85em;opacity:0.8;">Resident Portal</small></h3>
    </div>

    <ul class="sidebar-menu" id="navList">
      <li><a href="/user/dashboard" data-tooltip="Dashboard"><span class="icon">ğŸ ï¸</span><span class="label">Dashboard</span></a></li>
      <li><a href="/user/document-permits" class="active" data-tooltip="Request Documents"><span class="icon">ğŸ“„</span><span class="label">Request Documents</span></a></li>
      <li><a href="/user/community" data-tooltip="Community"><span class="icon">ğŸ¤</span><span class="label">Community</span></a></li>
      <li><a href="/user/cases" data-tooltip="Report Cases"><span class="icon">âš–ï¸</span><span class="label">Report Cases</span></a></li>
      <li><a href="/user/health" data-tooltip="Health Services"><span class="icon">ğŸ¥</span><span class="label">Health Services</span></a></li>
      <li><a href="/user/disaster" data-tooltip="Disaster Info"><span class="icon">ğŸš¨</span><span class="label">Disaster Info</span></a></li>

      <li style="margin-top:50px;"><a href="/user/settings" data-tooltip="Settings"><span class="icon">âš™ï¸</span><span class="label">Settings</span></a></li>
      <li><a href="#" onclick="fetch('/api/logout',{method:'POST'}).then(()=>location.href='/login')" data-tooltip="Log out"><span class="icon">ğŸšª</span><span class="label">Log out</span></a></li>
    </ul>
  </nav>

  <main class="main-content">
    <header class="header">
      <div class="header-left">
        <button class="hamburger" id="hamburgerBtn" aria-label="Toggle sidebar"><span></span></button>
        <h1 class="app-title">Request Documents</h1>
      </div>
      <div class="user-info" id="userChip">
        <button class="btn btn-outline" id="notifBtn" title="Notifications">ğŸ””</button>
        <div class="user-avatar" id="avatar">U</div>
        <span id="username" class="user-name">User</span>

        <div class="notif-panel" id="notifPanel">
          <div class="notif-head">Notifications</div>
          <div class="notif-item">No new notifications.</div>
        </div>

        <div class="dropdown" id="userMenu">
          <div class="item" id="goProfile">ğŸ‘¤ Profile</div>
          <div class="item" id="goSettings">âš™ï¸ Settings</div>
          <div class="item" id="doLogout">ğŸšª Log out</div>
        </div>
      </div>
    </header>

    <div class="content-area">
      <!-- Info Banner -->
      <div class="bg-[#1a237e] text-white px-5 py-4 rounded-lg mb-6 shadow-sm">
        <div class="flex items-start gap-3">
          <div class="text-xl mt-0.5">â„¹ï¸</div>
          <div>
            <strong class="font-semibold block mb-1">Resident Portal</strong>
            <p class="text-sm m-0 leading-relaxed opacity-95">View and request your documents here. Only your requests are visible.</p>
      </div>
        </div>
      </div>

      <!-- Action Bar -->
      <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6">
        <button class="inline-flex items-center gap-2 px-5 py-3 bg-[#3498db] hover:bg-[#2980b9] text-white font-semibold rounded-xl shadow-lg hover:shadow-xl transition-all duration-200" id="addNewBtn">
          <span class="text-lg">+</span>
          <span>Request New Document</span>
        </button>
        <div class="relative w-full sm:w-auto sm:min-w-[320px]">
          <div class="absolute left-4 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
            </svg>
          </div>
          <input id="searchInput" type="text" placeholder="Search by type, purpose..." class="w-full pl-12 pr-4 py-3 bg-white rounded-xl border border-gray-200 focus:border-[#3498db] focus:ring-2 focus:ring-[#3498db]/20 outline-none transition-all shadow-sm hover:shadow-md"/>
        </div>
      </div>

      <!-- Table Card -->
      <div class="bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden">
        <div class="overflow-x-auto">
          <table class="w-full" id="docsTable">
            <thead class="bg-gray-50">
            <tr>
                <th class="px-6 py-4 text-left text-xs font-bold text-gray-600 uppercase tracking-wider border-b border-gray-200">Type of Document</th>
                <th class="px-6 py-4 text-left text-xs font-bold text-gray-600 uppercase tracking-wider border-b border-gray-200">Number of Copies</th>
                <th class="px-6 py-4 text-left text-xs font-bold text-gray-600 uppercase tracking-wider border-b border-gray-200">Date Requested</th>
                <th class="px-6 py-4 text-left text-xs font-bold text-gray-600 uppercase tracking-wider border-b border-gray-200">Date Released</th>
                <th class="px-6 py-4 text-left text-xs font-bold text-gray-600 uppercase tracking-wider border-b border-gray-200">Status</th>
            </tr>
          </thead>
            <tbody id="reqTbody" class="divide-y divide-gray-100 [&_tr:hover]:bg-blue-50/50 transition-colors">
            <!-- rows injected by user-document-permits.js -->
          </tbody>
        </table>
        </div>
      </div>

      <div class="pager mt-6" id="pager" style="display:none"></div>
    </div>
  </main>
</div>

<!-- Add/Edit Modal -->
<div class="fixed inset-0 bg-black/25 hidden items-center justify-center p-4 z-50 overflow-y-auto" id="formModal" aria-hidden="true">
  <div class="w-full max-w-[700px] bg-white rounded-xl shadow-[0_10px_40px_rgba(0,0,0,0.2)] overflow-hidden my-4">
    <header class="px-4 py-3 bg-[#f8f9fa] border-b border-[#ecf0f1] font-semibold text-[#2c3e50] text-lg" id="formTitle">Request New Document</header>
    <div class="p-4 max-h-[calc(100vh-180px)] overflow-y-auto">
      <div class="text-[#7f8c8d] mb-2.5" id="msg"></div>
      <form id="docForm" novalidate>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
          <div class="md:col-span-2">
            <label class="block text-[#7f8c8d] mb-1 text-sm font-medium">Select Resident (for validation) *</label>
            <div class="relative">
              <input id="residentSearch" type="text" placeholder="Search by name, resident ID, or contact number..." autocomplete="off" class="w-full px-3 py-2 border border-input rounded-lg bg-white focus:outline-none focus:ring-2 focus:ring-[#3498db]/30 focus:border-[#3498db] transition-all text-sm">
              <div id="residentDropdown" class="absolute z-50 w-full mt-1 bg-white border border-gray-200 rounded-lg shadow-lg max-h-60 overflow-y-auto hidden">
                <!-- Resident options will be populated here -->
              </div>
            </div>
            <p class="text-xs text-[#7f8c8d] mt-1">Search and select a resident to validate the request. This ensures the requester is a registered resident.</p>
            <input type="hidden" id="selectedResidentId">
          </div>

          <div>
            <label class="block text-[#7f8c8d] mb-1 text-sm font-medium">Type of Document *</label>
            <select id="typeOfDocument" required class="w-full px-3 py-2 border border-input rounded-lg bg-white focus:outline-none focus:ring-2 focus:ring-[#3498db]/30 focus:border-[#3498db] transition-all text-sm">
              <option>Barangay Clearance</option>
              <option>Certificate of Indigency</option>
              <option>Certificate of Residency</option>
              <option>Barangay ID</option>
              <option>Construction Permit</option>
            </select>
          </div>
          <div>
            <label class="block text-[#7f8c8d] mb-1 text-sm font-medium">Number of Copies *</label>
            <input id="numberOfCopies" type="number" min="1" value="1" required class="w-full px-3 py-2 border border-input rounded-lg bg-white focus:outline-none focus:ring-2 focus:ring-[#3498db]/30 focus:border-[#3498db] transition-all text-sm">
          </div>

          <div>
            <label class="block text-[#7f8c8d] mb-1 text-sm font-medium">Requester's Name *</label>
            <input id="requesterName" type="text" required readonly class="w-full px-3 py-2 border border-input rounded-lg bg-gray-50 text-gray-700 cursor-not-allowed focus:outline-none transition-all text-sm">
            <p class="text-xs text-[#7f8c8d] mt-1" id="nameHelp">Will be auto-filled when you select a resident</p>
          </div>
          <div>
            <label class="block text-[#7f8c8d] mb-1 text-sm font-medium">Requester's Address *</label>
            <input id="address" type="text" required readonly class="w-full px-3 py-2 border border-input rounded-lg bg-gray-50 text-gray-700 cursor-not-allowed focus:outline-none transition-all text-sm">
            <p class="text-xs text-[#7f8c8d] mt-1" id="addressHelp">Will be auto-filled when you select a resident</p>
          </div>

          <div class="md:col-span-2">
            <label class="block text-[#7f8c8d] mb-1 text-sm font-medium">Purpose *</label>
            <input id="purpose" type="text" placeholder="e.g. Employment, Scholarship" required class="w-full px-3 py-2 border border-input rounded-lg bg-white focus:outline-none focus:ring-2 focus:ring-[#3498db]/30 focus:border-[#3498db] transition-all text-sm">
          </div>

          <div>
            <label class="block text-[#7f8c8d] mb-1 text-sm font-medium">Payment Method</label>
            <select id="paymentMethod" class="w-full px-3 py-2 border border-input rounded-lg bg-white focus:outline-none focus:ring-2 focus:ring-[#3498db]/30 focus:border-[#3498db] transition-all text-sm">
              <option value="">Select Payment Method</option>
              <option>GCash</option>
              <option>GoTyme</option>
              <option>Local Bank</option>
            </select>
          </div>
          <div>
            <label class="block text-[#7f8c8d] mb-1 text-sm font-medium">Payment Status</label>
            <select id="paymentStatus" class="w-full px-3 py-2 border border-input rounded-lg bg-white focus:outline-none focus:ring-2 focus:ring-[#3498db]/30 focus:border-[#3498db] transition-all text-sm">
              <option value="">No payment found</option>
              <option>Successfully Paid</option>
              <option>Pending</option>
              <option>Failed</option>
            </select>
          </div>
        </div>
        <input type="hidden" id="docId"/>
      </form>
    </div>
    <footer class="flex justify-end gap-2 px-4 py-3 bg-[#f8f9fa] border-t border-[#ecf0f1]">
      <button class="px-4 py-2 rounded-lg border-none cursor-pointer bg-ghost-btn text-primary-btn font-medium hover:opacity-90 transition-opacity text-sm" id="cancelForm">Cancel</button>
      <button class="px-4 py-2 rounded-lg border-none cursor-pointer bg-primary-btn text-white font-semibold hover:opacity-90 transition-opacity shadow-sm text-sm" id="saveForm">Submit Request</button>
    </footer>
  </div>
</div>

<script defer src="/user/user-document-permits.js"></script>
</body>
</html>

